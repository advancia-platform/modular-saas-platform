'use client'\n\nimport { useState } from 'react'\nimport { Socket } from 'socket.io-client'\nimport { Settings, Power, RefreshCw, PlayCircle, PauseCircle, BarChart3, Terminal } from 'lucide-react'\n\ninterface AdminControlsProps {\n  socket: Socket | null\n  isConnected: boolean\n}\n\nexport default function AdminControls({ socket, isConnected }: AdminControlsProps) {\n  const [agentStatus, setAgentStatus] = useState('operational')\n  const [isLoading, setIsLoading] = useState<string | null>(null)\n  const [commandOutput, setCommandOutput] = useState<string[]>([])\n  const [lastCommand, setLastCommand] = useState<string | null>(null)\n\n  const executeCommand = async (command: string, parameters: any = {}) => {\n    if (!socket || !isConnected) {\n      addCommandOutput(`âŒ Cannot execute ${command}: Not connected to server`)\n      return\n    }\n\n    setIsLoading(command)\n    setLastCommand(command)\n    addCommandOutput(`ðŸ”„ Executing command: ${command}`)\n\n    try {\n      // Send command via Socket.IO\n      socket.emit('admin-command', {\n        command,\n        parameters,\n        user_id: 'admin-dashboard',\n        timestamp: new Date().toISOString()\n      })\n\n      // Also try REST API as backup\n      const response = await fetch('/api/v1/admin/command', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          command,\n          parameters,\n          user_id: 'admin-dashboard',\n          timestamp: new Date().toISOString()\n        })\n      })\n\n      if (response.ok) {\n        const result = await response.json()\n        addCommandOutput(`âœ… ${command} command accepted`)\n      } else {\n        addCommandOutput(`âŒ ${command} command failed: ${response.statusText}`)\n      }\n    } catch (error) {\n      addCommandOutput(`âŒ ${command} command error: ${error}`)\n    } finally {\n      setIsLoading(null)\n    }\n  }\n\n  const addCommandOutput = (message: string) => {\n    const timestamp = new Date().toLocaleTimeString()\n    setCommandOutput(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 9)])\n  }\n\n  const simulateThreat = async () => {\n    if (!socket || !isConnected) {\n      addCommandOutput('âŒ Cannot simulate threat: Not connected to server')\n      return\n    }\n\n    setIsLoading('simulate')\n    addCommandOutput('ðŸŽ¯ Simulating threat scenario...')\n\n    const testThreat = {\n      name: 'Simulated SQL Injection Attack',\n      timestamp: new Date().toISOString(),\n      source: 'dashboard_simulation',\n      severity: 'high',\n      events: [{\n        type: 'sql_injection',\n        target: 'user_database',\n        payload: \"' OR 1=1--\",\n        source_ip: '192.168.1.100'\n      }]\n    }\n\n    try {\n      const response = await fetch('/api/v1/threats/simulate', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(testThreat)\n      })\n\n      if (response.ok) {\n        const result = await response.json()\n        addCommandOutput('âœ… Threat simulation successful')\n        addCommandOutput(`ðŸ“Š Processing result: ${result.status}`)\n      } else {\n        addCommandOutput(`âŒ Threat simulation failed: ${response.statusText}`)\n      }\n    } catch (error) {\n      addCommandOutput(`âŒ Threat simulation error: ${error}`)\n    } finally {\n      setIsLoading(null)\n    }\n  }\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'operational': return 'text-green-500'\n      case 'warning': return 'text-yellow-500'\n      case 'critical': return 'text-red-500'\n      default: return 'text-muted-foreground'\n    }\n  }\n\n  return (\n    <div className=\"bg-card rounded-lg border p-6\">\n      <h2 className=\"text-xl font-semibold mb-4 flex items-center\">\n        <Settings className=\"w-6 h-6 text-primary mr-3\" />\n        Admin Controls\n      </h2>\n\n      {/* Agent Status */}\n      <div className=\"bg-muted/20 rounded-lg p-4 mb-6\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-sm font-medium\">Agent Status</span>\n          <span className={`text-sm font-bold ${getStatusColor(agentStatus)}`}>\n            {agentStatus.toUpperCase()}\n          </span>\n        </div>\n        <div className=\"mt-2 flex items-center space-x-2\">\n          <div className={`w-2 h-2 rounded-full ${\n            agentStatus === 'operational' ? 'bg-green-500 animate-pulse' :\n            agentStatus === 'warning' ? 'bg-yellow-500 animate-pulse' :\n            'bg-red-500'\n          }`}></div>\n          <span className=\"text-xs text-muted-foreground\">\n            {isConnected ? 'Connected' : 'Disconnected'}\n          </span>\n        </div>\n      </div>\n\n      {/* Control Buttons */}\n      <div className=\"grid grid-cols-2 gap-3 mb-6\">\n        <button\n          onClick={() => executeCommand('restart_agent')}\n          disabled={!isConnected || isLoading === 'restart_agent'}\n          className=\"flex items-center justify-center space-x-2 bg-primary/10 hover:bg-primary/20 disabled:opacity-50 disabled:cursor-not-allowed border border-primary/20 rounded-lg px-4 py-3 text-sm font-medium transition-colors\"\n        >\n          {isLoading === 'restart_agent' ? (\n            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <Power className=\"w-4 h-4\" />\n          )}\n          <span>Restart Agent</span>\n        </button>\n\n        <button\n          onClick={() => executeCommand('get_diagnostics')}\n          disabled={!isConnected || isLoading === 'get_diagnostics'}\n          className=\"flex items-center justify-center space-x-2 bg-blue-500/10 hover:bg-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed border border-blue-500/20 rounded-lg px-4 py-3 text-sm font-medium transition-colors\"\n        >\n          {isLoading === 'get_diagnostics' ? (\n            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <BarChart3 className=\"w-4 h-4\" />\n          )}\n          <span>Diagnostics</span>\n        </button>\n\n        <button\n          onClick={() => executeCommand('pause_monitoring')}\n          disabled={!isConnected || isLoading === 'pause_monitoring'}\n          className=\"flex items-center justify-center space-x-2 bg-yellow-500/10 hover:bg-yellow-500/20 disabled:opacity-50 disabled:cursor-not-allowed border border-yellow-500/20 rounded-lg px-4 py-3 text-sm font-medium transition-colors\"\n        >\n          {isLoading === 'pause_monitoring' ? (\n            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <PauseCircle className=\"w-4 h-4\" />\n          )}\n          <span>Pause</span>\n        </button>\n\n        <button\n          onClick={simulateThreat}\n          disabled={!isConnected || isLoading === 'simulate'}\n          className=\"flex items-center justify-center space-x-2 bg-orange-500/10 hover:bg-orange-500/20 disabled:opacity-50 disabled:cursor-not-allowed border border-orange-500/20 rounded-lg px-4 py-3 text-sm font-medium transition-colors\"\n        >\n          {isLoading === 'simulate' ? (\n            <RefreshCw className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <PlayCircle className=\"w-4 h-4\" />\n          )}\n          <span>Test Threat</span>\n        </button>\n      </div>\n\n      {/* Command Output Terminal */}\n      <div className=\"bg-black/20 rounded-lg p-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className=\"text-sm font-medium flex items-center\">\n            <Terminal className=\"w-4 h-4 mr-2\" />\n            Command Output\n          </h3>\n          <button\n            onClick={() => setCommandOutput([])}\n            className=\"text-xs text-muted-foreground hover:text-foreground transition-colors\"\n          >\n            Clear\n          </button>\n        </div>\n        \n        <div className=\"bg-background/50 rounded border h-40 overflow-y-auto p-3 font-mono text-xs\">\n          {commandOutput.length === 0 ? (\n            <div className=\"text-muted-foreground italic\">\n              Command output will appear here...\n            </div>\n          ) : (\n            <div className=\"space-y-1\">\n              {commandOutput.map((line, index) => (\n                <div key={index} className=\"text-green-400\">\n                  {line}\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"mt-6 pt-4 border-t border-border\">\n        <div className=\"text-xs text-muted-foreground mb-2\">Quick Actions:</div>\n        <div className=\"flex flex-wrap gap-2\">\n          <button\n            onClick={() => window.open('/api/v1/health', '_blank')}\n            className=\"text-xs px-2 py-1 bg-muted/20 hover:bg-muted/40 rounded transition-colors\"\n          >\n            View Health API\n          </button>\n          <button\n            onClick={() => window.open('/api/v1/metrics', '_blank')}\n            className=\"text-xs px-2 py-1 bg-muted/20 hover:bg-muted/40 rounded transition-colors\"\n          >\n            View Metrics API\n          </button>\n          <button\n            onClick={() => executeCommand('update_config', { log_level: 'debug' })}\n            disabled={!isConnected}\n            className=\"text-xs px-2 py-1 bg-muted/20 hover:bg-muted/40 disabled:opacity-50 rounded transition-colors\"\n          >\n            Debug Mode\n          </button>\n        </div>\n      </div>\n\n      {/* Connection Info */}\n      {isConnected && (\n        <div className=\"mt-4 text-xs text-muted-foreground\">\n          Last command: {lastCommand || 'None'} â€¢ Connected to localhost:8001\n        </div>\n      )}\n    </div>\n  )\n}
